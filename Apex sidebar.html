<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Coding - Categories Sidebar (Full)</title>
<style>

    .mobile-toggle {
  display: none;
}
/* related resource: Apex sidebar.html:135:1 */
.controls .btn { /* the element was button.btn */
  color: rgb(215 30 55);
}
/* Combined styles (All -> Coding replacements applied) */
:root{
  --accent:#ff7b00;
  --bg:#f6f7fb;
  --card:#ffffff;
  --muted:#6b6b6b;
  --text:#222;
  --sidebar:#0f1720;
}
*{box-sizing:border-box}
body { margin:0; font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif; background:var(--bg); color:var(--text); }

/* layout */
.wrapper {
  display:flex;
  gap:24px;
  max-width:1200px;
  margin:28px auto;
  padding:0 16px;
  align-items:flex-start;
}

/* SIDEBAR */
.sidebar {
  width:280px;
  background:linear-gradient(180deg,#07101a, #0f2430);
  color:#fff;
  border-radius:12px;
  padding:18px;
  position:sticky;
  top:20px;
  height:calc(100vh - 40px);
  overflow:auto;
  box-shadow:0 10px 30px rgba(2,6,23,0.35);
}
.sidebar .side-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:14px; }
.side-head h3{ margin:0; font-size:18px; color:var(--accent); }
.side-controls { display:flex; gap:8px; align-items:center; }

/* search inside sidebar */
.side-search {
  display:flex;
  gap:8px;
  margin-bottom:12px;
  align-items:center;
  background: rgba(255,255,255,0.03);
  padding:8px;
  border-radius:10px;
}
.side-search input {
  flex:1;
  padding:10px 12px;
  border-radius:8px;
  border:0;
  outline:none;
  font-size:14px;
  background: transparent;
  color: #fff;
}
.side-search .toggle-btn {
  padding:8px 10px;
  border-radius:8px;
  background:rgba(255,255,255,0.06);
  border:0;
  color:#fff;
  cursor:pointer;
  font-size:13px;
}

/* category main buttons */
.cat-main {
  display:flex;
  align-items:center;
  justify-content:space-between;
  width:100%;
  padding:12px;
  margin-bottom:8px;
  background:rgba(255,255,255,0.03);
  border-radius:10px;
  border:0;
  color:#e6eef6;
  text-align:left;
  font-weight:600;
  cursor:pointer;
}
.cat-main:hover { background:rgba(255,255,255,0.06); }
.cat-main .caret{ transition: transform .25s ease; }

/* sub-wrap */
.sub-wrap{
  margin:8px 0 14px 6px;
  display:none;
  flex-direction:column;
  gap:8px;
}
.sub-btn {
  padding:9px 12px;
  border-radius:8px;
  background:rgba(255,255,255,0.03);
  color:#cfe3f2;
  text-align:left;
  border:0;
  cursor:pointer;
  font-size:14px;
}
.sub-btn:hover{ background: rgba(255,255,255,0.06); color:#fff; }

/* active styles */
.cat-main.active, .sub-btn.active {
  background: linear-gradient(90deg, rgba(255,123,0,0.12), rgba(255,123,0,0.06));
  box-shadow: inset 0 0 0 1px rgba(255,123,0,0.06);
  color:#fff;
}

/* MAIN CONTENT */
.content { flex:1; min-height:400px; }
.controls { display:flex; gap:12px; align-items:center; margin-bottom:18px; flex-wrap:wrap; }
.controls .info { font-size:14px; color:var(--muted); }
.controls .btn { padding:9px 12px; border-radius:10px; border:0; cursor:pointer; background:var(--card); box-shadow:0 6px 18px rgba(12,20,28,0.06); }

/* posts stack */
.posts { background:transparent; display:flex; flex-direction:column; gap:18px; }

/* single card */
.post-card { display:flex; gap:18px; background:var(--card); padding:14px; border-radius:12px; box-shadow:0 8px 28px rgba(18,24,32,0.06); align-items:flex-start; transition: transform .22s ease, box-shadow .22s ease; }
.post-card:hover{ transform: translateY(-6px); box-shadow:0 18px 40px rgba(16,24,32,0.09); }

/* thumbnail */
.post-thumb { width:220px; height:140px; border-radius:10px; overflow:hidden; flex-shrink:0; position:relative; background:#f0f0f0; display:flex; align-items:center; justify-content:center; }
.post-thumb img{ width:100%; height:100%; object-fit:cover; display:block; transition: transform .5s ease; }
.post-card:hover .post-thumb img { transform: scale(1.06); }

/* content text */
.post-body { flex:1; }
.post-title { margin:0 0 6px 0; font-size:18px; color:var(--text); text-decoration:none; display:block; font-weight:700; }
.post-excerpt { margin:6px 0 8px 0; color:var(--muted); font-size:14px; line-height:1.5; }

/* badges */
.badges { display:flex; gap:8px; align-items:center; margin-top:8px; }
.badge {
  font-size:13px;
  padding:6px 8px;
  border-radius:999px;
  background:rgba(15,20,24,0.05);
  color:var(--muted);
}

/* meta */
.meta-row { display:flex; gap:12px; align-items:center; color:var(--muted); font-size:13px; margin-top:6px; }

/* responsive */
@media (max-width: 920px) {
  .wrapper { padding:22px; gap:12px; max-width:100%; }
  .sidebar {
    position:fixed;
    left:-320px;
    top:0;
    height:100%;
    width:300px;
    z-index:999;
    border-radius:0;
    transition: left .34s cubic-bezier(.2,.9,.2,1);
  }
  .sidebar.open { left:0; }
  .content { margin-left:0; }
  .mobile-toggle {
    position: fixed;
    left:0;
    top:40%;
    transform:translateY(-50%);
    z-index:1000;
    width:44px;
    height:120px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--accent);
    color:#fff;
    border-radius:0 10px 10px 0;
    cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,0.2);
    writing-mode: vertical-rl;
    text-orientation: mixed;
    font-weight:700;
    letter-spacing:1px;
  }
  .post-card { flex-direction:column; gap:12px; }
  .post-thumb { width:100%; height:220px; }
}

.hidden-item { display:none !important; }
</style>
</head>
<body>
<!-- MOBILE BUTTON -->
<div class="mobile-toggle" onclick="toggleSidebar()">&nbsp;&nbsp;MENU</div>

<div class="wrapper">

  <aside class="sidebar" id="sidebar">

    <div class="side-head">
      <h3>Categories</h3>
      <div class="side-controls">
        <button class="toggle-btn" id="darkToggle">Dark</button>
      </div>
    </div>

    <div class="side-search">
      <input type="search" id="sidebarSearch" placeholder="Search labels or posts...">
      <button class="toggle-btn" id="sidebarClear">Clear</button>
    </div>

    <!-- MAIN + SUB -->
    <button class="cat-main" data-main="Breakfast" onclick="openMainAndLoad(event)">Category 1 <span class="caret">▾</span></button>
    <div class="sub-wrap" data-parent="Breakfast">
      <button class="sub-btn" data-label="Pancakes" onclick="loadLabel('Pancakes', this)">sub category 1</button>
      <button class="sub-btn" data-label="Omelette" onclick="loadLabel('Omelette', this)">sub category 2</button>
      <button class="sub-btn" data-label="Smoothie" onclick="loadLabel('Smoothie', this)">sub category 3</button>
    </div>

    <button class="cat-main" data-main="Drinks" onclick="openMainAndLoad(event)">Category 2 <span class="caret">▾</span></button>
    <div class="sub-wrap" data-parent="Drinks">
      <button class="sub-btn" data-label="Coffee" onclick="loadLabel('Coffee', this)">sub category 1</button>
      <button class="sub-btn" data-label="Mocktails" onclick="loadLabel('Mocktails', this)">sub category 2</button>
      <button class="sub-btn" data-label="Juices" onclick="loadLabel('Juices', this)">sub category 3</button>
    </div>

    <button class="cat-main" data-main="Dinner" onclick="openMainAndLoad(event)">Category 3 <span class="caret">▾</span></button>
    <div class="sub-wrap" data-parent="Dinner">
      <button class="sub-btn" data-label="Rice" onclick="loadLabel('Rice', this)">sub category 1</button>
      <button class="sub-btn" data-label="Curry" onclick="loadLabel('Curry', this)">sub category 2</button>
      <button class="sub-btn" data-label="Noodles" onclick="loadLabel('Noodles', this)">sub category 3</button>
    </div>

    <button class="cat-main" data-main="Dessert" onclick="openMainAndLoad(event)">Category 4 <span class="caret">▾</span></button>
    <div class="sub-wrap" data-parent="Dessert">
      <button class="sub-btn" data-label="Cakes" onclick="loadLabel('Cakes', this)">sub category 1</button>
      <button class="sub-btn" data-label="Muffins" onclick="loadLabel('Muffins', this)">sub category 2</button>
      <button class="sub-btn" data-label="Cookies" onclick="loadLabel('Cookies', this)">sub category 3</button>
    </div>

  </aside>

  <!-- CONTENT -->
  <main class="content">

    <div class="controls">
      <button class="btn" onclick="loadLabel('Coding')">Show Coding</button>
      <span class="info" id="showingInfo">Showing: Coding</span>
    </div>

    <section class="posts" id="postContainer">
      <div style="padding:40px; text-align:center; color:var(--muted);">
        Select a sub-category (or the main category) from the left to load posts.
      </div>
    </section>

  </main>
</div>

<script>
/* Helper: safe escape */
function esc(s){ 
  return (s||'').replace(/[&<>"']/g, m => (
      {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]
  )); 
}

/* MOBILE SIDEBAR TOGGLE */
function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("open");
}
document.addEventListener("click", e => {
  if (window.innerWidth < 920){
    const sb = document.getElementById("sidebar");
    if (!sb.contains(e.target) && !e.target.classList.contains("mobile-toggle")){
      sb.classList.remove("open");
    }
  }
});

/* DARK MODE TOGGLE */
document.getElementById("darkToggle").onclick = () => {
  document.body.classList.toggle("dark");
  const btn = document.getElementById("darkToggle");
  if(document.body.classList.contains('dark')){
    document.documentElement.style.setProperty('--card','#0b1220');
    btn.textContent = 'Light';
  } else {
    document.documentElement.style.setProperty('--card','#ffffff');
    btn.textContent = 'Dark';
  }
};

/* SUB-BUTTON active state */
document.querySelectorAll('.sub-btn').forEach(b=>{
  b.addEventListener('click', function(){
    document.querySelectorAll('.sub-btn').forEach(s=>s.classList.remove('active'));
    this.classList.add('active');
  });
});

/* SIDEBAR SEARCH & CLEAR */
const sidebarSearch = document.getElementById('sidebarSearch');
const sidebarClear = document.getElementById('sidebarClear');

if(sidebarSearch){
  sidebarSearch.addEventListener('input', function(){
    const q = this.value.trim().toLowerCase();
    filterSidebarAndPosts(q);
    if(window.innerWidth <= 920){
      if(q) document.getElementById('sidebar').classList.add('open');
      else document.getElementById('sidebar').classList.remove('open');
    }
  });
}
if(sidebarClear){
  sidebarClear.addEventListener('click', function(){
    if(sidebarSearch) sidebarSearch.value = '';
    filterSidebarAndPosts('');
  });
}

/* ======================================================
   POSTS LOADER (Guaranteed thumbnails) & helpers
   ====================================================== */
function extractImg(html){
  if(!html) return null;
  const div = document.createElement('div');
  div.innerHTML = html;
  const img = div.querySelector('img');
  if(!img) return null;
  const attrs = ['data-src','data-original','data-lazy','data-echo','src'];
  for(const a of attrs){
    const v = img.getAttribute(a);
    if(v) return v;
  }
  return img.src || null;
}

function buildExcerpt(html, len=180){
  const txt = html.replace(/<[^>]+>/g,'').replace(/\s+/g,' ').trim();
  return txt.length > len ? txt.slice(0,len) + '...' : txt;
}

function loadLabel(label, btnRef){
  const container = document.getElementById('postContainer') || document.getElementById('postsContainer');
  const showing = document.getElementById('showingInfo') || document.getElementById('currentLabel');
  showing.textContent = 'Showing: ' + label;
  container.innerHTML = '<div style="padding:40px;text-align:center;color:#888">Loading…</div>';

  const encoded = encodeURIComponent(label);
  const feedUrl = (label === "Coding") ? `/feeds/posts/default/-/${encoded}?alt=json&max-results=30` : `/feeds/posts/default/-/${encoded}?alt=json&max-results=30`;

  fetch(feedUrl)
    .then(r => {
      if(!r.ok) throw new Error('Network error');
      return r.json();
    })
    .then(data => {
      const items = (data.feed && data.feed.entry) ? data.feed.entry : [];
      if(items.length === 0){
        container.innerHTML = `<div style="padding:40px;text-align:center;color:#888">No posts under "${label}"</div>`;
        return;
      }

      let out = '';
      items.forEach(e => {
        const title = e.title?.$t || 'Untitled';
        let link = '#';
        if(e.link){
          const alt = e.link.find(l => l.rel === 'alternate');
          if(alt) link = alt.href;
        }

        const htmlContent = e.content?.$t || e.summary?.$t || '';
        let thumb = extractImg(htmlContent);
        if(!thumb && e.media$thumbnail){
          try{
            thumb = e.media$thumbnail.url.replace(/\/s72-c/,'/s600');
          }catch(err){
            thumb = e.media$thumbnail.url;
          }
        }
        if(!thumb){
          thumb = 'https://via.placeholder.com/800x600?text=No+Image';
        }

        const excerpt = buildExcerpt(htmlContent, 180);

        out += `
          <article class="post-card">
            <a class="post-thumb" href="${esc(link)}" target="_blank" rel="noopener">
              <img src="${esc(thumb)}" loading="lazy" alt="${esc(title)}">
            </a>
            <div class="post-body">
              <a class="post-title" href="${esc(link)}" target="_blank" rel="noopener">${esc(title)}</a>
              <div class="post-excerpt">${esc(excerpt)}</div>
              <div class="meta-row">
                <div class="badge">Label: ${esc(label)}</div>
                <div style="flex:1"></div>
                <button class="btn" onclick="window.open('${esc(link)}','_blank')">Open post</button>
              </div>
            </div>
          </article>
        `;
      });

      container.innerHTML = out;
    })
    .catch(err => {
      console.error(err);
      container.innerHTML = `<div style="padding:40px;text-align:center;color:#c33">Failed to load posts</div>`;
    });
}

/* SUB-BUTTONS: load their specific label and main category toggles */
document.addEventListener('click', function(e){
  const sb = e.target.closest('.sub-btn');
  if(sb){
    const label = sb.dataset.sub || sb.textContent.trim();
    document.querySelectorAll('.sub-btn').forEach(x => x.classList.remove('active'));
    sb.classList.add('active');
    loadLabel(label);
  }

  const cm = e.target.closest('.cat-main');
  if(cm){
    const parent = cm.dataset.cat || cm.textContent.trim();
    document.querySelectorAll('.sub-wrap').forEach(w => w.style.display = 'none');
    const wrap = cm.nextElementSibling;
    if(wrap && wrap.classList.contains('sub-wrap')){
      wrap.style.display = (wrap.style.display === 'flex') ? 'none' : 'flex';
      wrap.style.flexDirection = 'column';
    }
    loadLabel(parent);
    document.querySelectorAll('.cat-main').forEach(x => x.classList.remove('active'));
    cm.classList.add('active');
  }
});

/* SIDEBAR SEARCH (filter categories + posts) */
function filterSidebarAndPosts(q){
  q = (q||'').toString().trim().toLowerCase();
  const mains = document.querySelectorAll('.cat-main');
  const subs = document.querySelectorAll('.sub-btn');
  const wraps = document.querySelectorAll('.sub-wrap');
  const posts = document.querySelectorAll('#postContainer .post-card, #postsContainer .post-card');

  if(!q){
    mains.forEach(m => m.style.display = '');
    subs.forEach(s => s.style.display = '');
    wraps.forEach(w => w.style.display = 'none');
    posts.forEach(p => p.style.display = '');
    return;
  }

  // filter posts
  posts.forEach(p => {
    const title = (p.querySelector('.post-title')?.textContent || '').toLowerCase();
    const excerpt = (p.querySelector('.post-excerpt')?.textContent || '').toLowerCase();
    const badges = (p.querySelector('.badges')?.textContent || '').toLowerCase();
    const labelBadge = (p.querySelector('.meta-row .badge')?.textContent || '').toLowerCase();
    p.style.display = (title.includes(q) || excerpt.includes(q) || badges.includes(q) || labelBadge.includes(q)) ? '' : 'none';
  });

  // filter sidebar labels
  mains.forEach(main => {
    const mainText = main.textContent.toLowerCase();
    let matchMain = mainText.includes(q);
    let matchSub = false;

    const childSubs = document.querySelectorAll(`.sub-wrap .sub-btn`);
    childSubs.forEach(sub => {
      const subText = sub.textContent.toLowerCase();
      if(subText.includes(q)){
        sub.style.display = 'block';
        matchSub = true;
      } else {
        sub.style.display = 'none';
      }
    });

    if(matchMain || matchSub){
      main.style.display = 'flex';
      if(matchSub){
        const wrap = main.nextElementSibling;
        if(wrap && wrap.classList.contains('sub-wrap')){
          wrap.style.display = 'flex';
          wrap.style.flexDirection = 'column';
        }
      }
    } else {
      main.style.display = 'none';
    }
  });
}

/* attach search listeners */
if(sidebarSearch){
  sidebarSearch.addEventListener('input', e => filterSidebarAndPosts(e.target.value));
}

/* quick post search helper */
function quickPostSearch(q){
  q = (q||'').toString().trim().toLowerCase();
  const posts = document.querySelectorAll('#postContainer .post-card, #postsContainer .post-card');
  if(!q){ posts.forEach(p=>p.style.display=''); return; }
  posts.forEach(p=>{
    const title = (p.querySelector('.post-title')?.textContent || '').toLowerCase();
    const excerpt = (p.querySelector('.post-excerpt')?.textContent || '').toLowerCase();
    const labelBadge = (p.querySelector('.meta-row .badge')?.textContent || '').toLowerCase();
    p.style.display = (title.includes(q) || excerpt.includes(q) || labelBadge.includes(q)) ? '' : 'none';
  });
}

/* AUTO-LOAD DEFAULT = Coding */
document.addEventListener("DOMContentLoaded", () => {
  loadLabel("Coding");
});
</script>

</body>
</html>
